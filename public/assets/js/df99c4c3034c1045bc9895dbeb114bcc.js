(function(){const searchParams={};const search=debounce(async(uid,offset=0)=>{const container=document.querySelector(`#c${uid}`);const cardsContainer=document.querySelector(`#c${uid} .cards-container`);if(!container||!cardsContainer)return;const loader=container.querySelector('.cards-search__loader');if(loader)loader.style.top=`${cardsContainer.offsetTop}px`;container.classList.add('loading');const response=await fetch('?type=21052021',{method:'POST',body:JSON.stringify({...searchParams[uid],offset})});const responseData=await response.json();if(response.status!==200)return;const loadMoreButton=document.querySelector(`#c${uid} .cards__load-more`);if(loadMoreButton){if(!responseData.count||responseData.count<=responseData.limit){loadMoreButton.classList.add('hidden');}else{loadMoreButton.classList.remove('hidden');loadMoreButton.setAttribute('data-offset',responseData.limit);}}
if(offset){cardsContainer.innerHTML=cardsContainer.innerHTML+responseData.html;}else{cardsContainer.innerHTML=responseData.html;}
document.dispatchEvent(new Event('lazyload-images'));container.classList.remove('loading');});function handleLoadMoreClick(){const buttons=document.querySelectorAll(`.cards__load-more`);if(!buttons.length)return;buttons.forEach(button=>{button.addEventListener('click',async()=>{const container=button.closest('.ctype-iffcomponents_cards');if(!container||container.classList.contains('loading'))return;const{offset}=button.dataset;await search(getUidFromContainer(container),parseInt(offset));});});}
function handlePostTypeClick(){const buttons=document.querySelectorAll('.cards-search__post-type');if(!buttons.length)return;buttons.forEach(button=>{button.addEventListener('click',()=>{const{value}=button.dataset;const uid=getUidFromContainer(button.closest('.ctype-iffcomponents_cards'));button.classList.toggle('selected');if(searchParams[uid].postTypes.includes(value)){searchParams[uid].postTypes=searchParams[uid].postTypes.filter(val=>val!==value);}else{searchParams[uid].postTypes.push(value);}
search(uid);});});}
function clearSearch(button){const container=button.closest('.ctype-iffcomponents_cards');if(!container)return;const selectedTypes=container.querySelectorAll('.cards-search__post-type.selected');if(selectedTypes.length){selectedTypes.forEach(selectedType=>selectedType.classList.remove('selected'));}
const searchActionButton=container.querySelector('[data-action="toggle-search-field"]');searchActionButton.classList.remove('active');const searchField=container.querySelector('.search__field-wrapper input');searchField.value='';const tagsDropdowns=container.querySelectorAll('.tag__dropdown select');if(tagsDropdowns.length){tagsDropdowns.forEach(select=>select.selectedIndex=0);}
const uid=getUidFromContainer(container);searchParams[uid].postTypes=[];searchParams[uid].tags=[];searchParams[uid].searchField='';search(uid);}
function toggleSearchField(button){button.classList.toggle('active');const searchField=button.querySelector('input');searchField.focus();}
function handleSearchFieldChange(){const searchFields=document.querySelectorAll('.search__field-wrapper input');if(!searchFields)return;searchFields.forEach(input=>{const uid=getUidFromContainer(input.closest('.ctype-iffcomponents_cards'));input.addEventListener('keyup',({target})=>{searchParams[uid].searchField=target.value;search(uid);});});}
function handleTagChange(){const tagsDropdowns=document.querySelectorAll('.tag__dropdown select');if(!tagsDropdowns)return;tagsDropdowns.forEach(select=>{const uid=getUidFromContainer(select.closest('.ctype-iffcomponents_cards'));select.addEventListener('change',()=>{searchParams[uid].tags=[];tagsDropdowns.forEach(select=>{if(select.value)searchParams[uid].tags.push(+select.value);});search(uid);});});}
function handleSearchActionClick(){const buttons=document.querySelectorAll('.cards-search__action');if(!buttons.length)return;buttons.forEach(button=>{button.addEventListener('click',()=>{const{action}=button.dataset;if(action==='clear')return clearSearch(button);if(action==='toggle-search-field')return toggleSearchField(button);});});}
function handleSearchFieldClick(){const searchFields=document.querySelectorAll('.search__field-wrapper');if(!searchFields.length)return;searchFields.forEach(searchField=>{searchField.addEventListener('click',e=>e.stopPropagation());});}
function initialize(){const containers=document.querySelectorAll('.ctype-iffcomponents_cards');if(!containers.length)return;containers.forEach(container=>{const uid=getUidFromContainer(container);searchParams[uid]={postTypes:[],tags:[],searchField:'',contentId:uid};});}
function getUidFromContainer(container){const{id}=container;return parseInt(id.replace('c',''));}
function debounce(func,timeout=500){let timer;return(...args)=>{clearTimeout(timer);timer=setTimeout(()=>{func.apply(this,args);},timeout);};}
document.addEventListener('DOMContentLoaded',function(){initialize();handleSearchFieldClick();handlePostTypeClick();handleSearchActionClick();handleSearchFieldChange();handleTagChange();handleLoadMoreClick();});})();